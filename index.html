<!DOCTYPE html>
<html>
<head>
    <title>Samsara Fest Navigator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #0a0a0a; color: white; margin: 0; padding: 20px; }
        #compass {
            width: 220px; height: 220px; border: 4px solid #39FF14; border-radius: 50%;
            margin: 30px auto; position: relative; box-shadow: 0 0 20px rgba(57, 255, 20, 0.3);
        }
        #arrow {
            width: 0; height: 0; border-left: 12px solid transparent; border-right: 12px solid transparent;
            border-bottom: 35px solid #39FF14; position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
        }
        .landmark-list { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; text-align: left; }
        .landmark-btn {
            background: #1a1a1a; color: #ccc; border: 1px solid #333; padding: 15px;
            border-radius: 10px; cursor: pointer; transition: 0.2s; font-size: 1rem;
        }
        .landmark-btn.active { background: #39FF14; color: #000; border-color: #39FF14; font-weight: bold; }
        #status-card { background: #161616; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        #dist-val { font-size: 2.5rem; color: #39FF14; margin: 5px 0; }
        button#init-btn { background: #39FF14; padding: 15px 40px; border-radius: 50px; border: none; font-weight: bold; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h2>Welcome to Samsara Fest</h2>
        <p>Tap below to start the navigator.</p>
        <button id="init-btn">Initialize Compass</button>
    </div>

    <div id="main-ui" style="display: none;">
        <div id="compass"><div id="arrow"></div></div>
        
        <div id="status-card">
            <div id="target-label">Heading to: ---</div>
            <div id="dist-val">---m</div>
        </div>

        <h3>Select Destination:</h3>
        <div class="landmark-list" id="btn-container"></div>
    </div>

    <script>
        const LANDMARKS = [
            { id: 'gaming', name: "Gaming Arena", lat: 18.489632, lon: 73.852767 },
            { id: 'stage', name: "Main Stage", lat: 18.5210, lon: 73.8570 },
            { id: 'food', name: "Food Court", lat: 18.5225, lon: 73.8585 }
        ];

        let currentTarget = LANDMARKS[0];
        let userPos = null;
        let heading = 0;

        // Math for distance (Haversine)
        function getDist(lat1, lon1, lat2, lon2) {
            const R = 6371000;
            const dLat = (lat2-lat1) * Math.PI/180;
            const dLon = (lon2-lon1) * Math.PI/180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        // Math for bearing
        function getBearing(lat1, lon1, lat2, lon2) {
            const y = Math.sin((lon2-lon1)*Math.PI/180) * Math.cos(lat2*Math.PI/180);
            const x = Math.cos(lat1*Math.PI/180)*Math.sin(lat2*Math.PI/180) - Math.sin(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.cos((lon2-lon1)*Math.PI/180);
            return (Math.atan2(y, x) * 180/Math.PI + 360) % 360;
        }

        function refresh() {
            if (!userPos) return;
            const d = getDist(userPos.lat, userPos.lon, currentTarget.lat, currentTarget.lon);
            const b = getBearing(userPos.lat, userPos.lon, currentTarget.lat, currentTarget.lon);
            
            document.getElementById('dist-val').innerText = `${Math.round(d)}m`;
            document.getElementById('target-label').innerText = `Heading to: ${currentTarget.name}`;
            document.getElementById('compass').style.transform = `rotate(${b - heading}deg)`;
        }

        // Create the buttons
        const container = document.getElementById('btn-container');
        LANDMARKS.forEach((loc, index) => {
            const btn = document.createElement('div');
            btn.className = `landmark-btn ${index === 0 ? 'active' : ''}`;
            btn.innerText = loc.name;
            btn.onclick = () => {
                document.querySelectorAll('.landmark-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTarget = loc;
                refresh();
            };
            container.appendChild(btn);
        });

        document.getElementById('init-btn').onclick = async () => {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                await DeviceOrientationEvent.requestPermission();
            }
            window.addEventListener('deviceorientationabsolute', (e) => {
                heading = e.alpha || e.webkitCompassHeading || 0;
                refresh();
            }, true);
            navigator.geolocation.watchPosition(p => {
                userPos = { lat: p.coords.latitude, lon: p.coords.longitude };
                refresh();
            }, null, { enableHighAccuracy: true });

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
        };
    </script>
</body>
</html>